{% extends 'base.html' %} {% block content %}
<div class="container mt-4">
  <h2 class="text-light">Список задач</h2>
  <div class="card mb-3 border-0 shadow-none">
  <div class="card-body bg-dark">
    <form method="get" style="display: flex; flex-direction: column; gap: 1rem;">
      <div class="mb-0">
        <label class="form-label text-light" for="id_status">Статус</label>
        <select name="status" class="form-select bg-secondary text-light" id="id_status" style="min-width: 200px;">
          <option value="">Выберите статус</option>
          {% for status in statuses %}
            <option value="{{ status.pk }}" {% if request.GET.status == status.pk|stringformat:"s" %}selected{% endif %}>{{ status.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-0">
        <label class="form-label text-light" for="id_assignee">Исполнитель</label>
        <select name="assignee" class="form-select bg-secondary text-light" id="id_assignee" style="min-width: 200px;">
          <option value="">Не назначен</option>
          {% for user in users %}
            <option value="{{ user.pk }}" {% if request.GET.assignee == user.pk|stringformat:"s" %}selected{% endif %}>{{ user.username }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-0">
        <label class="form-label text-light" for="id_label">Метка</label>
        <select name="labels" class="form-select bg-secondary text-light" id="id_label" style="min-width: 200px;">
          <option value="">Выберите метку</option>
          {% for label in labels %}
            <option value="{{ label.pk }}" {% if request.GET.labels == label.pk|stringformat:"s" %}selected{% endif %}>{{ label.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="mb-3 d-flex align-items-center">
        <div class="form-check">
          <input type="checkbox" name="own_tasks" class="form-check-input border-0" id="id_own_tasks" {% if request.GET.own_tasks == 'on' %}checked{% endif %}/>
          <label class="form-check-label text-light" for="id_own_tasks">Только свои задачи</label>
        </div>
      </div>
      <div class="mb-0 d-flex align-items-center">
        <input class="btn btn-primary border-0" type="submit" value="Показать" />
      </div>
    </form>
  </div>
  </div>
  {% if tasks %}
  <table class="table table-dark table-striped mt-4">
    <thead>
      <tr>
        <th>ID</th>
        <th>Название</th>
        <th>Статус</th>
        <th>Автор</th>
        <th>Исполнитель</th>
        <th>Метки</th>
        <th>Дата создания</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td>{{ task.id }}</td>
        <td>
          <a href="{% url 'task_detail' pk=task.pk %}" class="text-warning"
            >{{ task.name }}</a
          >
        </td>
        <td>{{ task.status.name }}</td>
        <td>{{ task.author.username }}</td>
        <td>{{ task.assignee.username|default:"Не назначен" }}</td>
        <td>
          {% for label in task.labels.all %}
            <span class="badge bg-secondary text-light">{{ label.name }}</span>
          {% empty %}
            <span class="badge bg-secondary text-light">Нет меток</span>
          {% endfor %}
        </td>
        <td>{{ task.created_at|date:"d.m.Y H:i" }}</td>
        <td>
          <a
            href="{% url 'task_update' pk=task.pk %}"
            class="btn btn-warning btn-sm"
            >Изменить</a
          >
          {% if request.user == task.author %}
          <a
            href="{% url 'task_delete' pk=task.pk %}"
            class="btn btn-danger btn-sm"
            >Удалить</a
          >
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-light">Нет задач.</p>
  {% endif %}
  <a href="{% url 'task_create' %}" class="btn btn-success mt-3"
    >Добавить задачу</a
  >
</div>
{% endblock %}
